$(function(){function t(t,a){return t.toLocaleString()}$(".dropdown-toggle").dropdown();var a=$("#infoBox"),i=$("#modalInvoice");$(".date").datetimepicker({format:"YYYY-MM-DD",locale:"es"}),$("#datepicker1").datetimepicker({format:"YYYY-MM-DD",locale:"es"}),$("#datepicker2").datetimepicker({format:"YYYY-MM-DD",locale:"es"}),$('input[name="pay_with"]').keypress(function(t){if(8!=t.which&&0!=t.which&&(t.which<48||t.which>57))return!1}),$('input[name="pay_with"]').keyup(function(t){var a=parseFloat($(this).val()?$(this).val():0),i=parseFloat($('input[name="total"]').val()),n=0;n=a-i<0?0:a-i,$('input[name="change"]').val(n)}),$(".btn-facturar").on("click",function(t){t.preventDefault();var i=$(this).attr("data-invoice"),n=$(this).attr("data-patient");$.ajax({type:"PUT",url:"/clinic/invoices/"+i,data:{client_name:$('input[name="client_name"]').val(),pay_with:$('input[name="pay_with"]').val(),change:$('input[name="change"]').val()},success:function(t){a.addClass("alert-success").html("Factura procesada!!!").show(),setTimeout(function(){a.removeClass("alert-success").hide()},3e3),window.location.href="/clinic/patients/"+n+"/invoices"},error:function(){}})}),$(".btn-print").on("click",function(t){t.preventDefault();var i=$(this).attr("data-invoice"),n=$(this).attr("data-show");"1"!=n?$.ajax({type:"PUT",url:"/clinic/invoices/"+i,data:{client_name:$('input[name="client_name"]').val(),pay_with:$('input[name="pay_with"]').val(),change:$('input[name="change"]').val()},success:function(t){a.addClass("alert-success").html("Factura procesada!!!").show(),setTimeout(function(){a.removeClass("alert-success").hide()},3e3),$("#rd_ticket").is(":checked")?window.location.href="/clinic/invoices/"+i+"/ticket":window.location.href="/clinic/invoices/"+i+"/print"},error:function(){}}):$("#rd_ticket").is(":checked")?window.location.href="/clinic/invoices/"+i+"/ticket":window.location.href="/clinic/invoices/"+i+"/print"}),i.on("hidden.bs.modal",function(t){var a=$(this),i=a.find("#table-details");i.find("tbody").html(""),a.find("#modal-label-medic").text("")}),i.on("shown.bs.modal",function(a){var i=$(a.relatedTarget),n=$(this),e=i.attr("data-id"),c=i.attr("data-patient"),l=n.find("#table-details"),o="";n.find(".btn-facturar").attr("data-invoice",e),n.find(".btn-facturar").attr("data-patient",c),n.find(".btn-print").attr("data-invoice",e),n.find(".btn-print").attr("data-medic",c),$.ajax({type:"GET",url:"/clinic/invoices/"+e+"/details",data:{},success:function(a){n.find("#modal-label-medic").text(""),l.find("tbody").html("");var i=a.consecutivo;n.find("#modal-label-medic").text(a.medic.name),n.find("#modal-label-patient").text(a.appointment.patient.fullname),n.find("#modal-label-patient").text(a.appointment.patient.fullname),$('input[name="client_name"]').val(a.appointment.patient.fullname),$('input[name="pay_with"]').val(a.pay_with?a.pay_with:""),$('input[name="change"]').val(a.change),$.each(a.lines,function(a,i){o+="<tr><td>"+i.quantity+"</td><td>"+i.service+"</td><td>"+t(i.amount)+"</td><td>"+t(i.total_line)+"</td></tr>"}),l.find("tbody").html(o),$("#modalInvoiceLabel").html("Factura #"+i+'  <span class="label label-warning pull-right">'+a.created_at+"</span>"),$("#modal-label-total").html("Total: â‚¡<span>"+t(a.total)+"</span>"),$('input[name="total"]').val(a.total),a.status?(n.find(".btn-print").focus(),n.find(".btn-facturar").hide(),$(".pay_with_label").html(t(a.pay_with)),$(".change_label").html(t(a.change)),$(".pay_with-field").remove(),$(".change-field").remove(),n.find(".btn-print").attr("data-show","1")):$('input[name="pay_with"]').focus()},error:function(){}})})});