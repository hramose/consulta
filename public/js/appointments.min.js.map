{"version":3,"sources":["appointments.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"appointments.min.js","sourcesContent":["$(function () {\r\n\r\n    var isMobile = {\r\n      Android: function() {\r\n          return navigator.userAgent.match(/Android/i);\r\n      },\r\n      BlackBerry: function() {\r\n          return navigator.userAgent.match(/BlackBerry/i);\r\n      },\r\n      iOS: function() {\r\n          return navigator.userAgent.match(/iPhone|iPad|iPod/i);\r\n      },\r\n      Opera: function() {\r\n          return navigator.userAgent.match(/Opera Mini/i);\r\n      },\r\n      Windows: function() {\r\n          return navigator.userAgent.match(/IEMobile/i);\r\n      },\r\n      any: function() {\r\n          return (isMobile.Android() || isMobile.BlackBerry() || isMobile.iOS() || isMobile.Opera() || isMobile.Windows());\r\n      }\r\n  };\r\n\r\n  if( isMobile.any() ) {\r\n      $('.box-create-appointment').hide();\r\n    }else{\r\n      //$('.box-create-appointment').show();\r\n    }\r\n\r\n\r\n    $(\".dropdown-toggle\").dropdown();\r\n    /* initialize the external events\r\n     -----------------------------------------------------------------*/\r\n    function ini_events(ele) {\r\n      ele.each(function () {\r\n\r\n        var eventObject = {\r\n          title: $.trim($(this).text()), // use the element's text as the event title\r\n          //user_id: $(this).data('doctor'),\r\n          patient_id: $(this).data('patient'),\r\n          //created_by: $(this).data('createdby')\r\n          \r\n        };\r\n\r\n        // store the Event Object in the DOM element so we can get to it later\r\n        $(this).data('eventObject', eventObject);\r\n       \r\n        // make the event draggable using jQuery UI\r\n        $(this).draggable({\r\n          zIndex: 1070,\r\n          revert: true, // will cause the event to go back to its\r\n          revertDuration: 0  //  original position after the drag\r\n        });\r\n       \r\n      });\r\n    }\r\n   \r\n\r\n    ini_events($('#external-events div.external-event'));\r\n\r\n    /** load events from db **/\r\n    function fetch_events() {\r\n\r\n        $.ajax({\r\n            type: 'GET',\r\n            url: '/medic/appointments/list',\r\n            data: {},\r\n            success: function (resp) {\r\n                console.log(resp);\r\n\r\n                var appointments = [];\r\n\r\n                $.each(resp, function( index, item ) {\r\n                   \r\n                    item.allDay = parseInt(item.allDay); // = false;\r\n                    \r\n                    if(item.patient_id == 0){\r\n                      //item.rendering = 'background';\r\n                      \r\n\r\n                    }\r\n                    \r\n                    //debugger\r\n\r\n                    appointments.push(item);\r\n                });\r\n               \r\n                initCalendar(appointments);\r\n                \r\n            },\r\n            error: function () {\r\n                console.log('Error - '+ resp);\r\n\r\n            }\r\n        });\r\n\r\n\r\n    }\r\n    function fetch_offices() {\r\n\r\n        $.ajax({\r\n            type: 'GET',\r\n            url: '/medic/account/offices/list',\r\n            data: {},\r\n            success: function (resp) {\r\n                console.log(resp);\r\n\r\n                var offices = [];\r\n                var currColor = \"#00a65a\";\r\n                $.each(resp, function( index, item ) {\r\n                   \r\n                    \r\n\r\n                    offices.push(item);\r\n                    \r\n                    var event = $(\"<div />\");\r\n                    event.css({\"background-color\": currColor, \"border-color\": currColor, \"color\": \"#fff\"}).addClass(\"external-event\");\r\n                    event.attr('data-patient', 0);\r\n                    //event.attr('data-doctor', $('input[name=user_id]').val());\r\n                    event.html('');\r\n                    event.html(item.name);\r\n\r\n                    $('#external-events').prepend(event);\r\n\r\n                    //Add draggable funtionality\r\n                    var eventObject = {\r\n                      title: $.trim(item.name), // use the element's text as the event title\r\n                      //user_id: $(this).data('doctor'),\r\n                      patient_id: 0,\r\n                      office_info: JSON.stringify(item)\r\n                      //created_by: $(this).data('createdby')\r\n                      \r\n                    };\r\n\r\n                    // store the Event Object in the DOM element so we can get to it later\r\n                    event.data('eventObject', eventObject);\r\n                   \r\n                    // make the event draggable using jQuery UI\r\n                    event.draggable({\r\n                      zIndex: 1070,\r\n                      revert: true, // will cause the event to go back to its\r\n                      revertDuration: 0  //  original position after the drag\r\n                    });\r\n\r\n\r\n\r\n                });\r\n               \r\n                \r\n                \r\n                \r\n            },\r\n            error: function () {\r\n                console.log('Error - '+ resp);\r\n\r\n            }\r\n        });\r\n\r\n\r\n    }\r\n\r\n    fetch_events();\r\n    fetch_offices();\r\n\r\n\r\n    /* initialize the calendar\r\n     -----------------------------------------------------------------*/\r\n    //Date for the calendar events (dummy data)\r\n    var date = new Date();\r\n    var d = date.getDate(),\r\n        m = date.getMonth(),\r\n        y = date.getFullYear();\r\n\r\n    function initCalendar(appointments)\r\n    {\r\n\r\n      $('#calendar').fullCalendar({\r\n          locale: 'es',\r\n          defaultView: 'agendaWeek',\r\n          timeFormat: 'h(:mm)a',\r\n          header: {\r\n            left: 'prev,next today',\r\n            center: 'title',\r\n            right: 'agendaWeek,agendaDay'\r\n          },\r\n          //Random default events\r\n          events: appointments,\r\n          forceEventDuration: true,\r\n          slotDuration:'00:20:00',\r\n          defaultTimedEventDuration: '00:20:00',\r\n          editable: true,\r\n          droppable: true, // this allows things to be dropped onto the calendar !!!\r\n          eventOverlap: false,\r\n          businessHours: {\r\n              // days of week. an array of zero-based day of week integers (0=Sunday)\r\n              dow: [ 1, 2, 3, 4, 5,6], // Monday - Thursday\r\n\r\n              start: '07:00', // a start time (10am in this example)\r\n              end: '18:00', // an end time (6pm in this example)\r\n          },\r\n          //weekends: false,\r\n          scrollTime: '07:00:00',\r\n          nowIndicator: true,\r\n          timezone: 'local',\r\n          allDaySlot: false,\r\n          drop: function (date, allDay) { // this function is called when something is dropped\r\n            \r\n\r\n            // retrieve the dropped element's stored Event Object\r\n            var originalEventObject = $(this).data('eventObject');\r\n          \r\n            // we need to copy it, so that multiple events don't have a reference to the same object\r\n            var copiedEventObject = $.extend({}, originalEventObject);\r\n            \r\n            // assign it the date that was reported\r\n            copiedEventObject.start = date;\r\n           \r\n            \r\n            copiedEventObject.allDay = false;//allDay;\r\n            copiedEventObject.backgroundColor = $(this).css(\"background-color\");\r\n            copiedEventObject.borderColor = $(this).css(\"border-color\");\r\n            copiedEventObject.overlap = false;\r\n            // render the event on the calendar\r\n            // the last `true` argument determines if the event \"sticks\" (http://arshaw.com/fullcalendar/docs/event_rendering/renderEvent/)\r\n\r\n            var _id = $('#calendar').fullCalendar('renderEvent', copiedEventObject, true)[0]._id; // get _id from event in the calendar (this is for if user will remove the event)\r\n            \r\n           \r\n            saveAppointment(copiedEventObject, _id);\r\n\r\n           \r\n           /* if($(this).data('patient'))\r\n              $(this).remove(); // remover de citas sin agendar*/\r\n         \r\n           \r\n          },\r\n          eventResize: function(event, delta, revertFunc) {\r\n\r\n              updateAppointment(event, revertFunc);\r\n          \r\n           \r\n          },\r\n          eventDrop: function(event, delta, revertFunc) {\r\n            \r\n              updateAppointment(event, revertFunc);\r\n              \r\n\r\n          },\r\n          eventRender: function(event, element) {\r\n            element.append( \"<span class='closeon fa fa-trash'></span>\" );\r\n            element.append( \"<span class='appointment-details' ></span>\" );\r\n            element.find(\".closeon\").click(function() {\r\n               swal({\r\n                      title: \"Deseas cancelar la cita?\",\r\n                      text: \" Requerda que se eliminara del sistema!\",\r\n                      type: \"warning\",\r\n                      showCancelButton: true,\r\n                      confirmButtonClass: \"btn-danger\",\r\n                      confirmButtonText: \"Si, Cancelar!\",\r\n                      closeOnConfirm: false\r\n                    },\r\n                    function(){\r\n                      deleteAppointment(event._id, event);\r\n                      swal(\"Cita cancelada!\", \"Tu cita ha sido eliminada.\", \"success\");\r\n                    });\r\n               \r\n            });\r\n            if (event.rendering == 'background') {\r\n                element.append('<h3>'+ event.title + '</h3>');\r\n                \r\n            }\r\n\r\n\r\n             element.append('<div data-createdby=\"'+ event.created_by +'\"></div>');\r\n\r\n            if(event.patient_id && event.patient)\r\n            {\r\n\r\n              element.find(\".appointment-details\").click(function() {\r\n                  swal({\r\n                    title: 'Cita con el Paciente '+ event.patient.first_name + ' '+ event.patient.last_name,\r\n                    text: 'Fecha: '+ event.start.format(\"YYYY-MM-DD\") +' De: ' + event.start.format(\"HH:mm\") + ' a: ' + event.end.format(\"HH:mm\"),\r\n                    html: true\r\n                     \r\n                    });\r\n                   \r\n                    \r\n                     \r\n                  });\r\n             /* element.find(\".appointment-details\").popover({\r\n                  title: 'Cita con el Dr. '+ event.user.name,\r\n                  placement: 'top',\r\n                  html:true,\r\n                  container:'#calendar',\r\n                  trigger: 'click focus', \r\n                  content: 'Fecha: '+ event.start.format(\"YYYY-MM-DD\") +' <br>De: ' + event.start.format(\"HH:mm\") + ' a: ' + event.end.format(\"HH:mm\") + '<br>Paciente: ' + event.patient.first_name + ' '+ event.patient.last_name,\r\n              });*/\r\n\r\n            }else{\r\n        \r\n                var officeInfoDisplay = '';\r\n\r\n                if(event.office_info)\r\n                {\r\n                     var officeInfo = JSON.parse(event.office_info);\r\n\r\n                      officeInfoDisplay = '<br>Dirección: ' + officeInfo.address + ', ' + officeInfo.province +'<br>'+\r\n                      'Teléfono: '+ officeInfo.phone;\r\n                }\r\n\r\n                 element.find(\".appointment-details\").click(function() {\r\n                  swal({\r\n                    title: event.title,\r\n                    text: 'Fecha: '+ event.start.format(\"YYYY-MM-DD\") +' De: ' + event.start.format(\"HH:mm\") + ' a: ' + event.end.format(\"HH:mm\") + officeInfoDisplay,\r\n                    html: true\r\n                     \r\n                    });\r\n                   \r\n                });\r\n\r\n                /*element.find(\".appointment-details\").popover({\r\n                    title:  event.title,\r\n                    placement: 'top',\r\n                    html:true,\r\n                    container:'#calendar',\r\n                    trigger: 'click focus', \r\n                    content: 'Fecha: '+ event.start.format(\"YYYY-MM-DD\") +' <br>De: ' + event.start.format(\"HH:mm\") + ' a: ' + event.end.format(\"HH:mm\") + officeInfoDisplay,\r\n                });*/\r\n            }\r\n            \r\n\r\n        },\r\n        dayRender: function( date, cell ) {\r\n            /*console.log(date);\r\n             // It's an example, do your own test here\r\n            /*if(cell.hasClass(\"fc-other-month\")) {\r\n                  cell.addClass('disabled');\r\n             } */\r\n             \r\n            /*  var currentDate = new Date();\r\n             if(date < currentDate) {\r\n\r\n                   cell.addClass('bg-red disabled');\r\n              }*/\r\n             /* if (moment().diff(date,'days') > 0){\r\n                 \r\n                  cell.css(\"background-color\",\"silver\");\r\n              }*/\r\n              /*var currentDate = new Date();\r\n              var beginningTime = moment(date, 'h:mma');\r\n              var endTime = moment(currentDate, 'h:mma');\r\n              debugger\r\n              console.log(beginningTime.isBefore(endTime)); // true\r\n              console.log(beginningTime.toDate()); // Mon May 12 2014 08:45:00\r\n              console.log(endTime.toDate());\r\n               if(beginningTime.isBefore(endTime)) {\r\n\r\n                   cell.addClass('bg-red disabled');\r\n              }*/\r\n        },\r\n        dayClick: function(date, jsEvent, view) {\r\n              var currentDate = new Date();\r\n              \r\n             /* if($(jsEvent.target).hasClass(\"disabled\")){\r\n                  return false;\r\n              }*/\r\n              \r\n              if(date < currentDate || $(jsEvent.target).hasClass(\"fc-nonbusiness\")) {\r\n                   \r\n                   swal({\r\n                    title: 'Hora no permitida!',\r\n                    text: 'Debes seleccionar una hora valida',\r\n                    html: true\r\n                     \r\n                    });\r\n\r\n                   return false;\r\n              }\r\n\r\n              /*alert('Clicked on: ' + date.format());\r\n\r\n              alert('Coordinates: ' + jsEvent.pageX + ',' + jsEvent.pageY);\r\n\r\n              alert('Current view: ' + view.name);*/\r\n\r\n              // change the day's background color just for fun\r\n              //$(this).css('background-color', 'red');\r\n              \r\n              $('#myModal').modal({backdrop:'static', show:true });\r\n              $('#myModal').find('#modal-new-event').attr('data-modaldate', date.format());\r\n              $('#myModal').find('.modal-body').attr('data-modaldate', date.format());\r\n              $('#myModal').find('.modal-body').attr('data-date', date.format(\"dddd, MMMM Do YYYY\")).attr('data-hour', date.format(\"hh:mm a\" ));\r\n              \r\n                    \r\n           \r\n          }\r\n        \r\n      });\r\n\r\n    }\r\n\r\n    function isOverlapping(event) {\r\n     \r\n        var array = $('#calendar').fullCalendar('clientEvents');\r\n         \r\n          for(i in array){\r\n              if(event.idRemove != array[i]._id)\r\n              {\r\n                if (event.end > array[i].start._i && event.start < array[i].end._i){\r\n                   return true;\r\n                }\r\n              }\r\n          }\r\n          return false;\r\n    }\r\n    \r\n    /* SAVE UPDATE DELETE EVENTS */\r\n    function crud(method, url, data, revertFunc) {\r\n      \r\n      $.ajax({\r\n            type: method || 'POST',\r\n            url: url,\r\n            data: data,\r\n            success: function (resp) {\r\n              \r\n              if(method == \"POST\")\r\n              {\r\n                \r\n                $('#calendar').fullCalendar( 'removeEvents', data.idRemove)\r\n                \r\n                if(resp){\r\n\r\n                      \r\n                      resp.allDay = parseInt(resp.allDay);\r\n\r\n                      if(resp.allDay)\r\n                      {\r\n                        \r\n                        deleteAppointment(resp.id);\r\n                      \r\n                      }else{\r\n                          \r\n                          $('#calendar').fullCalendar('renderEvent', resp, true);\r\n\r\n                        }\r\n                }else{\r\n                  $('#infoBox').addClass('alert-danger').html('No se pudo crear la consulta!!').show();\r\n                        setTimeout(function()\r\n                        { \r\n                          $('#infoBox').removeClass('alert-danger').hide();\r\n                        },3000);\r\n\r\n                   return\r\n                }\r\n\r\n              }\r\n               if(method == \"DELETE\")\r\n               {\r\n                 if(resp)\r\n                 {\r\n                  $('#infoBox').addClass('alert-danger').html('No se puede eliminar consulta ya que se encuentra iniciada!!').show();\r\n                        setTimeout(function()\r\n                        { \r\n                          $('#infoBox').removeClass('alert-danger').hide();\r\n                        },3000);\r\n\r\n                   return\r\n                  }\r\n\r\n                  $('#calendar').fullCalendar('removeEvents',data.idRemove);\r\n              \r\n               }\r\n               \r\n               if(method == \"PUT\")\r\n               {\r\n                 if(resp == '')\r\n                 {\r\n                  $('#infoBox').addClass('alert-danger').html('No se puede cambiar de dia la consulta ya que se encuentra iniciada!!').show();\r\n                        setTimeout(function()\r\n                        { \r\n                          $('#infoBox').removeClass('alert-danger').hide();\r\n                        },3000);\r\n\r\n\r\n                    revertFunc();\r\n                    \r\n                   return\r\n                  }\r\n                   \r\n                   $('#calendar').fullCalendar( 'removeEvents', data.id)\r\n                   \r\n                    resp.allDay = parseInt(resp.allDay);\r\n                   \r\n\r\n                    $('#calendar').fullCalendar('renderEvent', resp, true);\r\n                  \r\n                  \r\n               }\r\n                \r\n            },\r\n            error: function () {\r\n              console.log('error saving appointment');\r\n\r\n            }\r\n        });\r\n    }\r\n    \r\n    function saveAppointment(event, idRemove)\r\n    {\r\n      \r\n      var appointment = {\r\n        title : event.title,\r\n        date : event.start.format(\"YYYY-MM-DD\"),\r\n        start : event.start.stripZone().format(),\r\n        end : (event.end) ? event.end.stripZone().format() : event.start.add(20, 'minutes').stripZone().format(),\r\n        backgroundColor: event.backgroundColor, //Success (green)\r\n        borderColor: event.borderColor,\r\n        //user_id: event.user_id,\r\n        patient_id: (event.patient_id) ? event.patient_id : 0,\r\n        //created_by: event.created_by,\r\n        idRemove: idRemove,\r\n        office_info: (event.office_info) ? event.office_info : '',\r\n        allDay: 0\r\n        \r\n      };\r\n     \r\n      if(isOverlapping(appointment)){\r\n        appointment.allDay = 1;\r\n      }\r\n\r\n      crud('POST', '/medic/appointments', appointment)\r\n\r\n    }\r\n\r\n     function updateAppointment(event, revertFunc)\r\n    {\r\n      \r\n      var appointment = {\r\n        //title : event.title,\r\n        date : event.start.format(\"YYYY-MM-DD\"),\r\n        start : event.start.stripZone().format(),\r\n        end : (event.end) ? event.end.stripZone().format() : event.start.add(20, 'minutes').stripZone().format(),\r\n        //backgroundColor: event.backgroundColor, //Success (green)\r\n        //borderColor: event.borderColor,\r\n        //user_id: event.user_id,\r\n        patient_id: event.patient_id,\r\n        //created_by: event.created_by,\r\n        id: event.id,\r\n        office_info: event.office_info,\r\n        allDay: event.allDay\r\n      };\r\n      \r\n      crud('PUT', '/medic/appointments/'+appointment.id, appointment, revertFunc)\r\n\r\n    }\r\n\r\n    function deleteAppointment(id)\r\n    {\r\n\r\n      crud('DELETE', '/medic/appointments/'+ id + '/delete', {idRemove:id})\r\n     \r\n    }\r\n\r\n    /* ADDING EVENTS */\r\n    var currColor = \"#3c8dbc\"; //Red by default\r\n    //Color chooser button\r\n    var colorChooser = $(\"#color-chooser-btn\");\r\n    $(\"#color-chooser > li > a\").click(function (e) {\r\n      e.preventDefault();\r\n      //Save color\r\n      currColor = $(this).css(\"color\");\r\n      //Add color effect to button\r\n      $('#add-new-event').css({\"background-color\": currColor, \"border-color\": currColor});\r\n      $('#modal-add-new-event').css({\"background-color\": currColor, \"border-color\": currColor});\r\n    });\r\n\r\n    function createEvent()\r\n    {\r\n      var val = $(\"#new-event\").val();\r\n      var valSelect = $(\".box-create-appointment\").find('.widget-user-2').attr('data-patient');\r\n      var valName = $(\".box-create-appointment\").find('.widget-user-2').attr('data-title');\r\n      if (valSelect.length == 0) {\r\n        return;\r\n      }\r\n     \r\n\r\n      //Create events\r\n      var event = $(\"<div />\");\r\n      event.css({\"background-color\": currColor, \"border-color\": currColor, \"color\": \"#fff\"}).addClass(\"external-event\");\r\n      event.attr('data-patient', valSelect);\r\n      /*event.attr('data-doctor', $('input[name=user_id]').val());\r\n      event.attr('data-createdby', $('input[name=user_id]').val());*/\r\n      event.html('');\r\n      event.html(val + ' - '+ valName);\r\n      $('#external-events').prepend(event);\r\n\r\n      //Add draggable funtionality\r\n      ini_events(event);\r\n\r\n      //Remove event from text input\r\n      $(\"#new-event\").val(\"\");\r\n      $(\".search-patients\").val(\"\").trigger('change');\r\n      $(\".search-patients\").text(\"\").trigger('change');\r\n    }\r\n\r\n    $(\"#new-event\").keypress(function( e ) {\r\n        if(e.which == 13) {\r\n            createEvent();\r\n        }\r\n    });\r\n\r\n    $(\"#add-new-event\").click(function (e) {\r\n      e.preventDefault();\r\n      \r\n      createEvent();\r\n      \r\n    });\r\n\r\n    $(\".search-patients\").select2({\r\n            placeholder: \"Buscar paciente\",\r\n            ajax: {\r\n              url: \"/medic/patients/list\",\r\n              dataType: 'json',\r\n              delay: 250,\r\n              data: function (params) {\r\n                return {\r\n                  q: params.term // search term\r\n                  \r\n                };\r\n              },\r\n              processResults: function (data) {\r\n               \r\n               // console.log(data.data);\r\n               $(\".search-patients\").empty();\r\n                var items = []\r\n                \r\n                $.each(data.data, function (index, value) {\r\n                    item = {\r\n                      id: value.id,\r\n                      text: value.first_name\r\n                    }\r\n                    items.push(item);\r\n                })\r\n              \r\n                    \r\n                return {\r\n                  results: items,\r\n                  \r\n                };\r\n              }\r\n\r\n            \r\n             \r\n            }\r\n     });\r\n\r\n    function createEventFromModal()\r\n    {\r\n      var val = $(\"#modal-new-event\").val();\r\n      var valSelect = $(\".modal-body\").find('.widget-user-2').attr('data-patient');//val();\r\n      var valName = $(\".modal-body\").find('.widget-user-2').attr('data-title');\r\n      var date = $.fullCalendar.moment($('#modal-new-event').attr('data-modaldate'));\r\n      if (valSelect.length == 0) {\r\n        return;\r\n      }\r\n     \r\n\r\n      //Create events\r\n\r\n      var eventObject = {\r\n          title: $.trim(val + ' - '+ valName), // use the element's text as the event title\r\n          //user_id: $('input[name=user_id]').val(),\r\n          patient_id: valSelect\r\n          //created_by: $('input[name=user_id]').val()\r\n         \r\n        };\r\n\r\n       var originalEventObject = eventObject;//event.data('eventObject');\r\n        \r\n        // we need to copy it, so that multiple events don't have a reference to the same object\r\n        var copiedEventObject = $.extend({}, originalEventObject);\r\n        \r\n        \r\n        // assign it the date that was reported\r\n        copiedEventObject.start = date;\r\n        if( date.isValid())\r\n        {\r\n         \r\n        \r\n        copiedEventObject.allDay = false;//allDay;\r\n        copiedEventObject.backgroundColor = currColor; //event.css(\"background-color\");\r\n        copiedEventObject.borderColor = currColor;//event.css(\"border-color\");\r\n        copiedEventObject.overlap = false;\r\n        // render the event on the calendar\r\n        // the last `true` argument determines if the event \"sticks\" (http://arshaw.com/fullcalendar/docs/event_rendering/renderEvent/)\r\n\r\n        var _id = $('#calendar').fullCalendar('renderEvent', copiedEventObject, true)[0]._id; // get _id from event in the calendar (this is for if user will remove the event)\r\n       \r\n       \r\n        saveAppointment(copiedEventObject, _id);\r\n      }\r\n      //Remove event from text input\r\n      $(\"#modal-new-event\").val(\"\");\r\n      //$(\".modal-search-patients\").val(\"\").trigger('change');\r\n      //$(\".modal-search-patients\").text(\"\").trigger('change');\r\n      $('#myModal').find('#modal-new-event').attr('data-modaldate', '');\r\n      $('#myModal').modal('hide');\r\n    }\r\n\r\n     $(\".btn-finalizar-cita\").click(function (e) {\r\n      e.preventDefault();\r\n\r\n      createEventFromModal();\r\n      \r\n    });\r\n   $(\".modal-search-patients\").select2({\r\n            placeholder: \"Buscar paciente\",\r\n            ajax: {\r\n              url: \"/medic/patients/list\",\r\n              dataType: 'json',\r\n              delay: 250,\r\n              data: function (params) {\r\n                return {\r\n                  q: params.term // search term\r\n                  \r\n                };\r\n              },\r\n              processResults: function (data) {\r\n               $(\".modal-search-patients\").empty();\r\n               // console.log(data.data);\r\n                var items = []\r\n                \r\n                $.each(data.data, function (index, value) {\r\n                    item = {\r\n                      id: value.id,\r\n                      text: value.first_name\r\n                    }\r\n                    items.push(item);\r\n                })\r\n              \r\n                    \r\n                return {\r\n                  results: items,\r\n                  \r\n                };\r\n              }\r\n\r\n            \r\n             \r\n            }\r\n     });\r\n\r\n\r\n    $('#myModal').on('shown.bs.modal', function (event) {\r\n      //debugger\r\n     // var button = $(event.relatedTarget) // Button that triggered the modal\r\n      var date = $(this).find('.modal-body').attr('data-date') // Extract info from data-* attributes\r\n      var hour = $(this).find('.modal-body').attr('data-hour')\r\n     \r\n      // If necessary, you could initiate an AJAX request here (and then do the updating in a callback).\r\n      // Update the modal's content. We'll use jQuery here, but you could use a data binding library or other methods instead.\r\n      var modal = $(this)\r\n      modal.find('.modal-title').html('Crear cita para el  <span class=\"label bg-yellow\">' + date + '</span> a las <span class=\"label bg-yellow\">'+ hour + '</span>' )\r\n      //modal.find('.modal-body').data('appointment','');\r\n    });\r\n\r\n\r\n\r\n  });\r\n/*$('#searchPatients').on('keypress', function(event) {\r\n\r\n        if (event.keyCode == 13) {\r\n            event.preventDefault();\r\n        }\r\n\r\n    });\r\n    $('#searchPatients').on('keyup', function(event) {\r\n        search();\r\n    });\r\n    function search() {\r\n\r\n        var input = $('#searchPatients'),\r\n            key =input.val(),\r\n            self = this;\r\n\r\n        if(key.length >=3 ){\r\n\r\n            $('.loading-search').removeClass('hidden');\r\n            clearTimeout( this.timer );\r\n            this.timer = setTimeout(function () {\r\n                console.log('search ' + key);\r\n                 \r\n                 $.ajax({\r\n                  type: 'GET',\r\n                  url: '/medic/patients/list',\r\n                  data: {search: key},\r\n                  success: function (resp) {\r\n                      console.log(resp.data);\r\n                      $('.search-list').html('');\r\n                      $.each(resp.data, function(index, value){\r\n\r\n                          var li = $('<li />').html(value.first_name);\r\n                          li.attr('data-id',value.id);\r\n                          console.log(value.id);\r\n                          $('.search-list').append(li);\r\n                      });\r\n\r\n                      //$('search-list').\r\n                     \r\n                  },\r\n                  error: function () {\r\n                     \r\n                    \r\n                  }\r\n              });\r\n\r\n            },200);\r\n\r\n\r\n        }else if(key.length == 0){\r\n            $('.dropdown').removeClass('open');\r\n            \r\n        }\r\n\r\n\r\n\r\n\r\n    }\r\n    $('.search-list').on('click','li', function (e) {\r\n        //console.log($(this).data('id'));\r\n\r\n\r\n    });*/"]}