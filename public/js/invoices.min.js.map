{"version":3,"sources":["invoices.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"invoices.min.js","sourcesContent":["$(function () {\r\n\r\n\r\n     $(\".dropdown-toggle\").dropdown();\r\n     var infoBox = $(\"#infoBox\");\r\n     var modalForm = $('#modalInvoice');\r\n\r\n    function money(n, currency) {\r\n\r\n        return n.toLocaleString();//toString().replace(/(\\d)(?=(\\d{3})+(?!\\d))/g, \"$1,\")\r\n    }\r\n    $('.date').datetimepicker({\r\n      format:'YYYY-MM-DD',\r\n      locale: 'es',\r\n      \r\n   });\r\n\r\n   $('input[name=\"pay_with\"]').keypress(function (e) {\r\n    //if the letter is not digit then display error and don't type anything\r\n    if (e.which != 8 && e.which != 0 && (e.which < 48 || e.which > 57)) {\r\n       //display error message\r\n      // $(\"#errmsg\").html(\"Digits Only\").show().fadeOut(\"slow\");\r\n              return false;\r\n   }\r\n  });\r\n   $('input[name=\"pay_with\"]').keyup(function( event ) {\r\n     \r\n    var payWith = parseFloat(($(this).val()) ? $(this).val() : 0);\r\n    var total =  parseFloat($('input[name=\"total\"]').val());\r\n    var change = 0;\r\n    change = ((payWith - total) < 0) ? 0 : payWith - total;\r\n    $('input[name=\"change\"]').val(change);\r\n\r\n    console.log(change)\r\n  })\r\n\r\n    $('.btn-facturar').on('click',function (e) {\r\n        e.preventDefault();\r\n      \r\n         var invoice_id = $(this).attr('data-invoice');\r\n         var medic_id = $(this).attr('data-medic');\r\n        \r\n      $('.loader').show();\r\n      $('#modalInvoice').find('.callout').addClass('hidden');\r\n        $.ajax({\r\n            type: 'PUT',\r\n            url: '/medic/invoices/'+invoice_id,\r\n          data: { client_name: $('input[name=\"client_name\"]').val(), client_email: $('input[name=\"client_email\"]').val(), medio_pago: $('select[name=\"medio_pago\"]').val(), pay_with: $('input[name=\"pay_with\"]').val(), change: $('input[name=\"change\"]').val() },\r\n            success: function (resp) {\r\n            \r\n              $('.loader').hide();\r\n              infoBox.addClass('alert-success').html('Factura procesada!!!').show();\r\n              setTimeout(function()\r\n              { \r\n                infoBox.removeClass('alert-success').hide();\r\n              },3000);\r\n\r\n              swal({\r\n                title: 'Factura procesada!!!',\r\n                text: \"¿Deseas imprimir la factura?\",\r\n                showCancelButton: true,\r\n                confirmButtonColor: '#d33',\r\n                cancelButtonColor: '#3085d6',\r\n                cancelButtonText: 'No',\r\n                confirmButtonText: 'Si'\r\n              }).then(function () {\r\n\r\n                if ($(\"#rd_ticket\").is(\":checked\"))\r\n                  window.location.href = \"/medic/invoices/\" + invoice_id + '/ticket';\r\n                else\r\n                  window.location.href = \"/medic/invoices/\" + invoice_id + '/print';\r\n\r\n              }, function (dismiss) { \r\n\r\n                window.location.href = \"/medic/invoices\"\r\n\r\n              });\r\n              \r\n              \r\n            \r\n              \r\n                \r\n            },\r\n            error: function (resp) {\r\n              $('.loader').hide();\r\n              if(resp.responseJSON.errors){\r\n                $('#modalInvoice').find('.error-certificate').text(resp.responseJSON.errors.certificate[0]);\r\n                $('#modalInvoice').find('.callout').removeClass('hidden');\r\n              }\r\n            }\r\n        });\r\n     \r\n\r\n    });\r\n\r\n    $('.btn-print').on('click',function (e) {\r\n      e.preventDefault();\r\n    \r\n       var invoice_id = $(this).attr('data-invoice');\r\n       var medic_id = $(this).attr('data-medic');\r\n       /*var show =  $(this).attr('data-show');\r\n       if(show != '1'){\r\n          $.ajax({\r\n            type: 'PUT',\r\n            url: '/medic/invoices/'+invoice_id,\r\n            data: {client_name: $('input[name=\"client_name\"]').val(), pay_with: $('input[name=\"pay_with\"]').val(), change: $('input[name=\"change\"]').val()},\r\n            success: function (resp) {\r\n            \r\n\r\n              infoBox.addClass('alert-success').html('Factura procesada!!!').show();\r\n              setTimeout(function()\r\n              { \r\n                infoBox.removeClass('alert-success').hide();\r\n              },3000);\r\n              \r\n              \r\n              \r\n              if($(\"#rd_ticket\").is(\":checked\"))\r\n                window.location.href = \"/medic/invoices/\"+invoice_id+'/ticket';\r\n              else\r\n                window.location.href = \"/medic/invoices/\"+invoice_id+'/print';\r\n              \r\n              \r\n                \r\n            },\r\n            error: function () {\r\n              console.log('error get details');\r\n\r\n            }\r\n        });\r\n      }else{*/\r\n\r\n          \r\n        if($(\"#rd_ticket\").is(\":checked\"))\r\n        window.location.href = \"/medic/invoices/\"+invoice_id+'/ticket';\r\n      else\r\n        window.location.href = \"/medic/invoices/\"+invoice_id+'/print';\r\n      \r\n\r\n     /* }*/\r\n      \r\n       \r\n\r\n  });\r\n\r\n    modalForm.on('hidden.bs.modal', function (e) {\r\n      var modal = $(this);\r\n      var table_details = modal.find('#table-details')\r\n      table_details.find('tbody').html('');\r\n      modal.find('#modal-label-medic').text('')\r\n    });\r\n     modalForm.on('shown.bs.modal', function (event) {\r\n     \r\n      var button = $(event.relatedTarget)\r\n      var modal = $(this);\r\n      var invoice_id = button.attr('data-id')\r\n      var medic_id = button.attr('data-medic')  \r\n      var table_details = modal.find('#table-details')\r\n      var detailsHtml = '';\r\n       modal.find('.callout').addClass('hidden');\r\n     \r\n      modal.find('.btn-facturar').attr('data-invoice', invoice_id);\r\n      modal.find('.btn-facturar').attr('data-medic', medic_id);\r\n      modal.find('.btn-print').attr('data-invoice', invoice_id);\r\n      modal.find('.btn-print').attr('data-medic', medic_id);\r\n      \r\n\r\n       $('.loader').show();\r\n     \r\n       $.ajax({\r\n            type: 'GET',\r\n            url: '/medic/invoices/'+invoice_id+'/details',\r\n            data: {},\r\n            success: function (resp) {\r\n              $('.loader').hide();\r\n\r\n               modal.find('#modal-label-medic').text('')\r\n               table_details.find('tbody').html('');\r\n              \r\n              var consecutivo = resp.consecutivo;\r\n\r\n               modal.find('#modal-label-medic').text(resp.medic.name);\r\n               modal.find('#modal-label-patient').text(resp.appointment.patient.fullname);\r\n               modal.find('#modal-label-patient').text(resp.appointment.patient.fullname);\r\n              $('input[name=\"client_name\"]').val((resp.client_name) ? resp.client_name : resp.appointment.patient.fullname);\r\n              $('input[name=\"client_email\"]').val((resp.client_email) ? resp.client_email : resp.appointment.patient.email);\r\n              $('input[name=\"medio_pago\"]').val(resp.medio_pago);\r\n               $('input[name=\"pay_with\"]').val((resp.pay_with) ? resp.pay_with : '');\r\n               $('input[name=\"change\"]').val(resp.change);\r\n               \r\n\r\n               $.each(resp.lines, function( index, item ) {\r\n                   \r\n                   detailsHtml +='<tr><td>'+ item.quantity +'</td><td>'+ item.service +'</td><td>'+ money(item.amount) +'</td><td>'+ money(item.total_line) +'</td></tr>'\r\n\r\n                });\r\n\r\n               table_details.find('tbody').html(detailsHtml);\r\n               \r\n              $(\"#modalInvoiceLabel\").html('Factura #' + consecutivo + '  <span class=\"label label-warning pull-right\">'+resp.created_at+'</span>');\r\n               $(\"#modal-label-total\").html('Total: ₡<span>'+ money(resp.total)+'</span>');\r\n               $('input[name=\"total\"]').val(resp.total);\r\n\r\n               if(resp.status){\r\n                \r\n                modal.find('.btn-print').focus();\r\n                modal.find('.btn-facturar').hide();\r\n                 $('input[name=\"client_name\"]').attr('disabled', true)\r\n                 $('input[name=\"client_email\"]').attr('disabled', true)\r\n                 $('select[name=\"medio_pago\"]').attr('disabled', true)\r\n                $('.pay_with_label').html( money(resp.pay_with));\r\n                $('.change_label').html( money(resp.change));\r\n                $('.pay_with-field').remove();\r\n                $('.change-field').remove();\r\n                modal.find('.btn-print').attr('data-show','1');\r\n              }else{\r\n                $('input[name=\"pay_with\"]').focus();\r\n                 modal.find('.btn-print').hide();\r\n               }\r\n                \r\n            },\r\n            error: function () {\r\n              console.log('error get details');\r\n              $('.loader').hide();\r\n\r\n            }\r\n        });\r\n     \r\n  \r\n     \r\n      \r\n   \r\n    });\r\n\r\n});\r\n"]}