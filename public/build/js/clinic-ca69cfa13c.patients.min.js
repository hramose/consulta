$(function(){function e(e){var t=d;for(i in t)if(e.end>t[i].start&&e.start<t[i].end)return!0;return!1}var t={Android:function(){return navigator.userAgent.match(/Android/i)},BlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},iOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return navigator.userAgent.match(/Opera Mini/i)},Windows:function(){return navigator.userAgent.match(/IEMobile/i)},any:function(){return t.Android()||t.BlackBerry()||t.iOS()||t.Opera()||t.Windows()}};t.any()?($(".box-create-appointment").hide(),$(".breadcrumb").hide()):$(".box-search-filters").removeClass("collapsed-box"),$(".dropdown-toggle").dropdown();var a=$("#initAppointment").find(".modal-body").attr("data-slotDuration"),n=moment.duration(a).asMinutes(),o="minutes",r=moment.duration(a).asMinutes();$("#datetimepicker1").datetimepicker({format:"YYYY-MM-DD",locale:"es",defaultDate:new Date}),$("#datetimepicker2").datetimepicker({format:"HH:mm",stepping:r,defaultDate:new Date}),$("#datetimepicker3").datetimepicker({format:"HH:mm",stepping:r,useCurrent:!1}),$("#initAppointment").on("shown.bs.modal",function(e){var t=$(e.relatedTarget),i=t.attr("data-patient"),a=t.attr("data-patientname");$(this).find(".modal-body").find("#patient-name").text(a),$(this).find(".modal-body").attr("data-modalpatient",i)});var d=[];$(".search-offices").select2({placeholder:"Selecciona el Consultorio donde quiere iniciar la consulta",templateResult:function(e){var t=$("<span></span>");return t.text(e.text),e.newOption&&t.css("color","red"),t},ajax:{url:"/clinic/account/offices/list",dataType:"json",delay:250,data:function(e){return{q:e.term}},processResults:function(e){$(".search-offices").empty();var t=[];$.each(e,function(e,i){item={id:i.id,text:i.name,office_info:JSON.stringify(i)},t.push(item)});var i={id:"No disponible",text:"No disponible",office_info:"",newOption:!0};return t.push(i),{results:t}}},templateSelection:function(e){return $(e.element).attr("data-office",e.office_info),e.text}}),$("#initAppointment").find(".add-cita").on("click",function(t){t.preventDefault();var i=$("#initAppointment"),a=i.find(".modal-body").attr("data-modalpatient"),r=i.find("#search-offices").val(),d=i.find('input[name="date"]').val(),s=i.find('input[name="start"]').val(),c=i.find('input[name="end"]').val(),l=d+"T"+s+":00",f=d+"T"+(c?c:s)+":00";if(!r)return $("#initAppointment").find("#search-offices").select2("focus"),$("#initAppointment").find("#search-offices").select2("open"),$("#infoBox").addClass("alert-danger").html("Escribe un consultorio. Por favor revisar!!!").show(),setTimeout(function(){$("#infoBox").removeClass("alert-danger").hide()},3e3),!1;if(!d||!s)return $("#infoBox").addClass("alert-danger").html("Fecha invalida. Por favor revisar!!!").show(),setTimeout(function(){$("#infoBox").removeClass("alert-danger").hide()},3e3),!1;if(moment(l).isAfter(f))return $("#infoBox").addClass("alert-danger").html("Fecha invalida. La hora de inicio no puede ser mayor que la hora final!!!").show(),setTimeout(function(){$("#infoBox").removeClass("alert-danger").hide()},3e3),!1;moment(l).isSame(f)&&(f=moment(l).add(n,o).stripZone().format());var m={title:"Cita",date:d,start:l,end:f,backgroundColor:"#3c8dbc",borderColor:"#3c8dbc",patient_id:a,office_id:r,office_info:"",allDay:0};return e(m)?($("#infoBox").addClass("alert-danger").html("No se puede iniciar esta cita por que ya hay una cita en el mismo horario. Por favor revisa tus citas programadas !!!").show(),setTimeout(function(){$("#infoBox").removeClass("alert-danger").hide()},3e3),!1):void $.ajax({type:"POST",url:"/clinic/appointments",data:m,success:function(e){e.allDay=parseInt(e.allDay),$("#initAppointment").find(".add-cita").attr("disabled","disabled"),$("#initAppointment").find(".btn-cancel").attr("disabled","disabled"),$("#infoBox").addClass("alert-success").html("Cita Creada Correctamente!!. Iniciando su cita, espere un momento").show(),setTimeout(function(){$("#infoBox").removeClass("alert-success").hide(),i.find("#patient-name").text(""),i.find(".modal-body").attr("data-modalpatient",""),i.find("#datetimepicker1").data("DateTimePicker").clear(),i.find("#datetimepicker2").data("DateTimePicker").clear(),i.find("#datetimepicker3").data("DateTimePicker").clear(),i.modal("hide"),$("#initAppointment").find(".add-cita").removeAttr("disabled"),$("#initAppointment").find(".btn-cancel").removeAttr("disabled"),window.location.href="/medic/appointments/"+e.id+"/edit"},3e3)},error:function(){}})})});