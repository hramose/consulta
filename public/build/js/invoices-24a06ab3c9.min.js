$(function(){function t(t,e){return t.toLocaleString()}$(".dropdown-toggle").dropdown();var e=$("#infoBox"),a=$("#modalInvoice");$(".date").datetimepicker({format:"YYYY-MM-DD",locale:"es"}),$('input[name="pay_with"]').keypress(function(t){if(8!=t.which&&0!=t.which&&(t.which<48||t.which>57))return!1}),$('input[name="pay_with"]').keyup(function(t){var e=parseFloat($(this).val()?$(this).val():0),a=parseFloat($('input[name="total"]').val()),n=0;n=e-a<0?0:e-a,$('input[name="change"]').val(n)}),$(".btn-facturar").on("click",function(t){t.preventDefault();var a=$(this).attr("data-invoice"),n=$(this).attr("data-medic");$.ajax({type:"PUT",url:"/medic/invoices/"+a,data:{client_name:$('input[name="client_name"]').val(),pay_with:$('input[name="pay_with"]').val()},success:function(t){e.addClass("alert-success").html("Factura procesada!!!").show(),setTimeout(function(){e.removeClass("alert-success").hide()},3e3),window.location.href="/assistant/medics/"+n+"/invoices"},error:function(){}})}),$(".btn-print").on("click",function(t){t.preventDefault();var a=$(this).attr("data-invoice"),n=($(this).attr("data-medic"),$(this).attr("data-show"));"1"!=n?$.ajax({type:"PUT",url:"/medic/invoices/"+a,data:{client_name:$('input[name="client_name"]').val(),pay_with:$('input[name="pay_with"]').val(),change:$('input[name="change"]').val()},success:function(t){e.addClass("alert-success").html("Factura procesada!!!").show(),setTimeout(function(){e.removeClass("alert-success").hide()},3e3),$("#rd_ticket").is(":checked")?window.location.href="/medic/invoices/"+a+"/ticket":window.location.href="/medic/invoices/"+a+"/print"},error:function(){}}):$("#rd_ticket").is(":checked")?window.location.href="/medic/invoices/"+a+"/ticket":window.location.href="/medic/invoices/"+a+"/print"}),a.on("hidden.bs.modal",function(t){var e=$(this),a=e.find("#table-details");a.find("tbody").html(""),e.find("#modal-label-medic").text("")}),a.on("shown.bs.modal",function(e){var a=$(e.relatedTarget),n=$(this),i=a.attr("data-id"),c=a.attr("data-medic"),o=n.find("#table-details"),l="";n.find(".btn-facturar").attr("data-invoice",i),n.find(".btn-facturar").attr("data-medic",c),n.find(".btn-print").attr("data-invoice",i),n.find(".btn-print").attr("data-medic",c),$(".loader").show(),$.ajax({type:"GET",url:"/medic/invoices/"+i+"/details",data:{},success:function(e){$(".loader").hide(),n.find("#modal-label-medic").text(""),o.find("tbody").html("");var a=e.consecutivo;n.find("#modal-label-medic").text(e.medic.name),n.find("#modal-label-patient").text(e.appointment.patient.fullname),n.find("#modal-label-patient").text(e.appointment.patient.fullname),$('input[name="client_name"]').val(e.appointment.patient.fullname),$('input[name="pay_with"]').val(e.pay_with?e.pay_with:""),$('input[name="change"]').val(e.change),$.each(e.lines,function(e,a){l+="<tr><td>"+a.quantity+"</td><td>"+a.service+"</td><td>"+t(a.amount)+"</td><td>"+t(a.total_line)+"</td></tr>"}),o.find("tbody").html(l),$("#modalInvoiceLabel").html("Factura #"+a+'  <span class="label label-warning pull-right">'+e.created_at+"</span>"),$("#modal-label-total").html("Total: â‚¡<span>"+t(e.total)+"</span>"),$('input[name="total"]').val(e.total),e.status?(n.find(".btn-print").focus(),n.find(".btn-facturar").hide(),$(".pay_with_label").html(t(e.pay_with)),$(".change_label").html(t(e.change)),$(".pay_with-field").remove(),$(".change-field").remove(),n.find(".btn-print").attr("data-show","1")):$('input[name="pay_with"]').focus()},error:function(){}})}),$("#modalRespHacienda").on("shown.bs.modal",function(t){var e=$(t.relatedTarget),a=e.attr("data-invoice");$(".loader").show(),$("#resp-clave").text(""),$("#resp-emisor").text(""),$("#resp-receptor").text(""),$("#resp-mensaje").text(""),$("#resp-detalle").text(""),$.ajax({type:"GET",url:"/medic/invoices/"+a+"/recepcion",data:{_token:$('meta[name="csrf-token"]').content},success:function(t){$(".loader").hide();var e=JSON.parse(t.resp_hacienda);$("#resp-clave").text(e.Clave),$("#resp-emisor").text(e.NombreEmisor),$("#resp-receptor").text(e.NombreReceptor),$("#resp-mensaje").text(e.Mensaje),$("#resp-detalle").text(e.DetalleMensaje)},error:function(){}})})});