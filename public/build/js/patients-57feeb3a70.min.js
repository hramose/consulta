$(function(){function t(){$.ajax({type:"GET",url:"/medic/appointments/list",data:{},success:function(t){o=[],$.each(t,function(t,e){e.allDay=parseInt(e.allDay),o.push(e)})},error:function(){}})}function e(t){var e=o;for(i in e)if(t.end>e[i].start&&t.start<e[i].end)return!0;return!1}var a={Android:function(){return navigator.userAgent.match(/Android/i)},BlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},iOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return navigator.userAgent.match(/Opera Mini/i)},Windows:function(){return navigator.userAgent.match(/IEMobile/i)},any:function(){return a.Android()||a.BlackBerry()||a.iOS()||a.Opera()||a.Windows()}};a.any()?($(".box-create-appointment").hide(),$(".breadcrumb").hide()):$(".box-search-filters").removeClass("collapsed-box"),$(".dropdown-toggle").dropdown();var n=$("#initAppointment").find(".modal-body").attr("data-slotDuration"),r="00"==n.split(":")[1]?n.split(":")[0]:n.split(":")[1];"01"==r&&(r="60"),$("#datetimepicker1").datetimepicker({format:"YYYY-MM-DD",locale:"es",defaultDate:new Date}),$("#datetimepicker2").datetimepicker({format:"HH:mm",stepping:r,defaultDate:new Date}),$("#datetimepicker3").datetimepicker({format:"HH:mm",stepping:r,useCurrent:!1}),$("#initAppointment").on("shown.bs.modal",function(t){var e=$(t.relatedTarget),a=e.attr("data-patient"),i=e.attr("data-patientname");$(this).find(".modal-body").find("#patient-name").text(i),$(this).find(".modal-body").attr("data-modalpatient",a)});var o=[];t(),$("#initAppointment").find(".add-cita").on("click",function(t){t.preventDefault();var a=$("#initAppointment"),i=a.find(".modal-body").attr("data-modalpatient"),n=a.find('input[name="date"]').val(),r=a.find('input[name="start"]').val(),o=a.find('input[name="end"]').val(),d=n+"T"+r,s=n+"T"+o;if(!n||!r||!o)return $("#infoBox").addClass("alert-danger").html("Fecha invalida. Por favor revisar!!!").show(),setTimeout(function(){$("#infoBox").removeClass("alert-danger").hide()},3e3),!1;if(moment(d).isAfter(s))return $("#infoBox").addClass("alert-danger").html("Fecha invalida. La hora de inicio no puede ser mayor que la hora final!!!").show(),setTimeout(function(){$("#infoBox").removeClass("alert-danger").hide()},3e3),!1;var c={title:"Cita",date:n,start:d,end:s,backgroundColor:"#3c8dbc",borderColor:"#3c8dbc",patient_id:i,office_info:"",allDay:0};return e(c)?($("#infoBox").addClass("alert-danger").html("No se puede iniciar esta cita por que ya hay una cita en el mismo horario. Por favor revisa tus citas programadas !!!").show(),setTimeout(function(){$("#infoBox").removeClass("alert-danger").hide()},3e3),!1):void $.ajax({type:"POST",url:"/medic/appointments",data:c,success:function(t){t.allDay=parseInt(t.allDay),$("#initAppointment").find(".add-cita").attr("disabled","disabled"),$("#initAppointment").find(".btn-cancel").attr("disabled","disabled"),$("#infoBox").addClass("alert-success").html("Cita Creada Correctamente!!. Iniciando su cita, espere un momento").show(),setTimeout(function(){$("#infoBox").removeClass("alert-success").hide(),a.find("#patient-name").text(""),a.find(".modal-body").attr("data-modalpatient",""),a.find("#datetimepicker1").data("DateTimePicker").clear(),a.find("#datetimepicker2").data("DateTimePicker").clear(),a.find("#datetimepicker3").data("DateTimePicker").clear(),a.modal("hide"),$("#initAppointment").find(".add-cita").removeAttr("disabled"),$("#initAppointment").find(".btn-cancel").removeAttr("disabled"),window.location.href="/medic/appointments/"+t.id+"/edit"},3e3)},error:function(){}})})});